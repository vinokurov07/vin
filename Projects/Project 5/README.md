# PROJECT-5. Предсказание дефолта клиента

## Оглавление  
[1. Описание проекта](README.md#Описание-проекта)  
[2. Краткая информация о данных](README.md#Краткая-информация-о-данных)  
[3. Этапы работы над проектом](README.md#Этапы-работы-над-проектом)  
[4. Результаты](README.md#Результаты)    
[5. Выводы](README.md#Выводы) 

### Описание проекта  

Имеется датасет. Тебуется предсказать, случится ли дефолт клиента по кредитной карте в следующем месяце.   


Бизнес-задача: определить характеристики, по которым можно выявить клиентов, более склонных невозврату заемных денег с помощью кредитной карты, и за счёт этого повысить уровень принятия решений при одобрении крединой карты/лимитов по ней.

Техническая задача: построить модель машинного обучения, которая на основе предложенных характеристик клиента будет предсказывать, вернет он заемные средства или нет.

:arrow_up:[к оглавлению](README.md#Оглавление)


### Краткая информация о данных

Этот набор данных содержит информацию о невыплаченных платежах, демографических факторах, кредитных данных, истории платежей и выписках по счетам клиентов кредитных карт на Тайване с апреля 2005 года по сентябрь 2005 года.

***Имеющиеся данные:***

* ID: ID of each client
* LIMIT_BAL: Amount of given credit in NT dollars (includes individual and family/supplementary credit
* SEX: Gender (1=male, 2=female)
* EDUCATION: (1=graduate school, 2=university, 3=high school, 4=others, 5=unknown, 6=unknown)
* MARRIAGE: Marital status (1=married, 2=single, 3=others)
* AGE: Age in years
* PAY_0: Repayment status in September, 2005 (-1=pay duly, 1=payment delay for one month, 2=payment delay for two months, … 8=payment delay for eight months, 9=payment delay for nine months and above)
* PAY_2: Repayment status in August, 2005 (scale same as above)
* PAY_3: Repayment status in July, 2005 (scale same as above)
* PAY_4: Repayment status in June, 2005 (scale same as above)
* PAY_5: Repayment status in May, 2005 (scale same as above)
* PAY_6: Repayment status in April, 2005 (scale same as above)
* BILL_AMT1: Amount of bill statement in September, 2005 (NT dollar)
* BILL_AMT2: Amount of bill statement in August, 2005 (NT dollar)
* BILL_AMT3: Amount of bill statement in July, 2005 (NT dollar)
* BILL_AMT4: Amount of bill statement in June, 2005 (NT dollar)
* BILL_AMT5: Amount of bill statement in May, 2005 (NT dollar)
* BILL_AMT6: Amount of bill statement in April, 2005 (NT dollar)
* PAY_AMT1: Amount of previous payment in September, 2005 (NT dollar)
* PAY_AMT2: Amount of previous payment in August, 2005 (NT dollar)
* PAY_AMT3: Amount of previous payment in July, 2005 (NT dollar)
* PAY_AMT4: Amount of previous payment in June, 2005 (NT dollar)
* PAY_AMT5: Amount of previous payment in May, 2005 (NT dollar)
* PAY_AMT6: Amount of previous payment in April, 2005 (NT dollar)
* default.payment.next.month: Default payment (1=yes, 0=no)
  
:arrow_up:[к оглавлению](README.md#Оглавление)


### Этапы работы над проектом  

1. Первичная обработка данных

    В рамках этой части обработаем пропуски и выбросы в данных. Это необходимо для дальнейшей работы с ними.

2. Разведывательный анализ данных (EDA)

    Необходимо будет исследовать данные, нащупать первые закономерности и выдвинуть гипотезы.

3. Создание новых признаков (Feature Engineering) и отбор признаков

    Нужно попробовать создать из действующих признаков новые, возможно получим больше информации и модель будет лучше прогнозировать.

4. Решение задачи классификации: логистическая регрессия и решающие деревья

    На данном этапе построим прогностические модели и оценим её качество. Подберем оптимальные параметры модели для того, чтобы получить наилучший результат для конкретного алгоритма.

5. Решение задачи классификации: ансамбли моделей и построение прогноза

    На этом этапе доработаем своё предсказание с использованием более сложных алгоритмов и оценим, с помощью какой модели возможно сделать более качественные прогнозы.

6. Выбор порога вероятности. PR-КРИВАЯ

    Попробуем изменить порог вероятности отнесения клиента к классу дефолта и посмотрим на метрики.

7. Сэмплирование

    Проведем сэмплирование данных, если они несбалансированы по целевой переменной и построим модель на новых данных.



:arrow_up:[к оглавлению](README.md#Оглавление)


### Результаты
[Весь проект выполнен в ноутбуке](</Projects/Project 5/Project 5.ipynb>)


:arrow_up:[к оглавлению](README.md#Оглавление)


### Выводы:  

Вывод: итак, в ходе работы были выполнены все этапы проекта.

1. Первичная обработка данных.
Данные были чистыми, пропусков и выбросов нет.

2. Разведывательный анализ данных (EDA).
Категориальные признаки уже закодированы, можно их использовать для построения модели.

3. Преобразование данных
На этом этапе были созданы новые признаки.
    Признаки, отслеживающие динамику платежей:
    PAY_DETERIORATION_COUNT - количество месяцев с ухудшением статуса платежа по сравнению с предыдущим месяцем
    RECENT_DETERIORATION - бинарный признак: было ли ухудшение статуса в последние 2 месяца
    MAX_DELINQUENCY_STATUS - максимальный статус просрочки за все 6 месяцев
    EVER_SERIOUS_DELINQUENT - бинарный признак: был ли клиент когда-либо в серьезной просрочке (статус ≥ 3)

    "Револьверный" кредит, когла клиент вносит постоянно минимальный платеж:
    REVOLVING_CREDIT_MONTHS - количество месяцев, когда клиент платил только минимальный платеж (статус = 0)
    REVOLVING_CREDIT_STREAK - бинарный признак: использует ли клиент револьверный кредит постоянно (3+ месяца подряд)

    Финансовые соотношения:

    PAYMENT_RATIO_SEP - соотношение платежа за сентябрь к долгу за август
    PAYMENT_RATIO_AUG - соотношение платежа за август к долгу за июль
    PAYMENT_RATIO_JUL - соотношение платежа за июль к долгу за июнь
    AVG_PAYMENT_RATIO_3M - среднее соотношение платежей за последние 3 месяца
    GOOD_PAYMENT_HABIT - бинарный признак: платит ли клиент больше минимального платежа (>10%)

    Использование кредитного лимита:
    CREDIT_UTILIZATION_SEP - текущая загрузка кредитного лимита (долг за сентябрь / лимит)
    AVG_CREDIT_UTILIZATION - средняя загрузка кредитного лимита за 6 месяцев
    MAX_CREDIT_UTILIZATION - максимальная загрузка кредитного лимита за 6 месяцев

    Признаки платежной активности:
    TOTAL_PAYMENTS_6M - суммарные платежи за 6 месяцев
    PAYMENT_TO_DEBT_RATIO - отношение суммарных платежей к среднему долгу
    
    Признаки просрочки:
    DELINQUENT_MONTHS_COUNT - количество месяцев с просрочкой платежа (статус ≥ 1)
    CURRENTLY_DELINQUENT - бинарный признак: есть ли текущая просрочка (последний месяц статус ≥ 1)


4. Решение задачи классификации: логистическая регрессия и решающие деревья
задача регрессии была решена с помощью двух моделей: линейной регрессии и дерева решений. Т.к. выборка несбалансирована, модель хорошо определяет клиентов, не имеющих вероятности дефолта. Даже применение стратификации при использовании hold-out валидации не особо помогает. Дальше модель была проверена с помощью K-Fold валидации со стратификацией. После этого в модели была добавлена балансирока данных, метрики качества при этом улучшились(для Logistic Regression - AUC: 0.7510, GINI: 0.5019).
Модель дерева решений была обучена на сбалансированных данных, также с помощью GridSearchCV были подобраны оптимальные гиперпараметры. Результат: DecisionTree - AUC: 0.7701, GINI: 0.5401.

5. Ансамбли моделей и построение прогноза
На этом этапе задача решалась более сложными моделями - с помощью моделей случайного леса и градиентвного бустинга над деревом решений. 
Для модели случайного леса оптимальыне гиперпараметры были подобраны с помощью RandomizedSearchCV. Но первоначальные параметры оказались лучше. Метрики составили RandomForest - AUC: 0.7799, GINI: 0.5598.

Также, для модели градиентного бустинга были подобраны оптимальные гиперпараметры с помощью Optuna. Однако, после обучения модели на оптимальных гиперпараметрах поднять качество снизилось. Для первоначальных гиперпараметров метрики составили GradientBoosting - AUC: 0.7804, GINI: 0.5609.

6. Далее была выбрана модель случайного леса, как имеющая один из лучших результатов и для улучшения метрик был изменен порог вероятности отношения клиента к классу 1, тк. целевой признак несбалансирован и модель лучше определяет клиентов без дефолта, чем наоборот. Смещение порога вероятности в меньшую сторону до 0.4 позволяет модели примерно одинаково находить объекты и класса 1 и класса 0, но точность снижается.

7. Далее было к исходным данным было применено сэмплирование, было сгенерировано дополнительное кол-во данных для класса 1.
 Модель случайного леса, обученная на этих данных имеет параметры RandomForest - AUC: 0.7804, GINI: 0.5609.

**Вывод:**
Модель правильно ранжирует клиентов в 78% случаев. Это значит, что если мы случайно выберем одного клиента, который уйдет в дефолт, и одного, кто не уйдет, то в 78 случаях из 100 модель присвоит дефолтному клиенту более высокий риск.
Есть что улучшить, но в целом модель показала хороший результат.

:arrow_up:[к оглавлению](README.md#Оглавление)

